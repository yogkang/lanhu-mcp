version: '3.8'

services:
  lanhu-mcp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: lanhu_mcp_service
    restart: unless-stopped
    env_file:
      - .env  # 从 .env 文件加载环境变量
    ports:
      - "8000:8000"  # 将宿主机的 8000 端口映射到容器的 8000 端口
    volumes:
      - ./data:/app/data  # 挂载数据目录，持久化缓存和截图
      - ./logs:/app/logs  # 挂载日志目录
    environment:
      # 这些环境变量会覆盖 .env 文件中的配置
      # 如果不需要覆盖，可以删除这些行
      - SERVER_HOST=0.0.0.0
      - SERVER_PORT=8000
      # LANHU_COOKIE 从 .env 文件读取
      # FEISHU_WEBHOOK_URL 从 .env 文件读取（可选）

# ============================================
# 使用说明
# ============================================
#
# 1. 首次使用前的准备：
#    - 复制 config.example.env 为 .env
#    - 编辑 .env 文件，设置你的 LANHU_COOKIE
#    - （可选）设置 FEISHU_WEBHOOK_URL 启用飞书通知
#
# 2. 启动服务：
#    docker-compose up -d
#
# 3. 查看日志：
#    docker-compose logs -f lanhu-mcp
#
# 4. 停止服务：
#    docker-compose down
#
# 5. 重新构建并启动：
#    docker-compose up -d --build
#
# 6. 在 Cursor 中连接：
#    添加以下配置到 Cursor 的 MCP 配置文件：
#    {
#      "mcpServers": {
#        "lanhu": {
#          "url": "http://localhost:8000/mcp?role=开发&name=你的名字"
#        }
#      }
#    }
#
# 7. 数据持久化：
#    - ./data 目录：存储下载的资源、截图、缓存
#    - ./logs 目录：存储应用日志
#    这些目录会自动创建，数据不会因容器重启而丢失
#
# 8. 端口说明：
#    - 8000:8000 表示宿主机端口:容器端口
#    - 如果宿主机 8000 端口被占用，可以修改为其他端口，例如：
#      "8001:8000" (宿主机使用8001，容器内仍是8000)
#    - 修改端口后，记得更新 Cursor 配置中的 URL
#
# 9. 环境变量优先级：
#    docker-compose.yml 中的 environment > .env 文件
#
# 10. 安全提示：
#     - 确保 .env 文件已添加到 .gitignore
#     - 不要将包含真实 Cookie 的 .env 文件提交到代码仓库
#     - 定期更换 LANHU_COOKIE
#
# 11. 故障排查：
#     - 查看日志：docker-compose logs -f
#     - 进入容器：docker-compose exec lanhu-mcp /bin/bash
#     - 检查容器状态：docker-compose ps
#     - 重启服务：docker-compose restart lanhu-mcp
#

